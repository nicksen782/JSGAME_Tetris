<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>...LOADING</title>
</head>

<body style="background-color: #181818;">
    <script>
        (
            async function(){
                // _APP.basePath = window.location.pathname.includes('/JSGAME/') ? '/JSGAME' : '';
                let basePath = window.location.pathname.includes('/JSGAME/') ? '/JSGAME' : '';
        
                let files = [
                    // { f:`${basePath}BASE/css/ui.css`      , t:"css", syncType: "sync"  }, // Use the game's base files. 
                    // { f:`${basePath}BASE/js/gameloader.js`, t:"js" , syncType: "async" }, // Use the game's base files. 
                    // { f:`${basePath}BASE/js/gameloop.js`  , t:"js" , syncType: "async" }, // Use the game's base files. 
                    { f:`${basePath}/SHARED/BASEUI_A/js/gameloader.js`, t:"js" , syncType: "sync"  }, // Use JSGAME's base files.
                    { f:`${basePath}/SHARED/BASEUI_A/js/gameloop.js`  , t:"js" , syncType: "async" }, // Use JSGAME's base files.
                    { f:`${basePath}/SHARED/BASEUI_A/css/ui.css`      , t:"css", syncType: "async" }, // Use JSGAME's base files.
                ];
                
                function loadResource(rec) {
                    return new Promise((resolve, reject) => {
                        // console.log("This is the rec:", rec);
                        let element;

                        if (rec.t === 'css') {
                            element = document.createElement('link');
                            element.rel = 'stylesheet';
                            element.href = rec.f;
                        } 
                        else if (rec.t === 'js') {
                            element = document.createElement('script');
                            element.src = rec.f;
                            element.defer = true;
                        } 
                        else {
                            console.log("error on this rec:", rec);
                            reject(`Invalid type: ${rec.t}`);
                            return;
                        }

                        element.onload  = resolve;
                        element.onerror = reject;

                        document.head.appendChild(element);
                    });
                }

                let proms = [];
                for(let rec of files){
                    try{ 
                        // loadResource(rec);
                        if     (rec.syncType == "sync") { await loadResource(rec); }
                        else if(rec.syncType == "async"){ proms.push( loadResource(rec) ); }
                    }
                    catch(e){ console.error('Error loading resource:', e); throw e; }
                }
                await Promise.all(proms);
        
                //
                _APP.basePath = basePath;
            }
        )();
    </script>

    <!-- Stand-Alone loading indicator. -->
    <div id="loading" style="position:fixed; top:5px; left:5px;">
        LOADING
        <div class="lds-spinner"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>
    </div>

    <!-- The main HTML. -->
    <div id="wrapper">
        <!-- NEEDS USER INPUT FOR AUDIO -->
        <div id="audio_userInputNeeded_container" style="display:none;">
            <div id="audio_userInputNeeded">
                Please click the screen<br>
                to allow audio to load.<br>
            </div>
        </div>

        <!-- ERROR DISPLAY -->
        <div id="error_display" style="display:none;">
            <div id="error_display_title">
                APPLICATION ERROR
                <div id="error_display_close">X</div>
            </div>
            <div id="error_display_text">
                <div id="error_display_text_inner"></div>
                <div>GAME LOOP STOPPED</div>
            </div>
        </div>

        <!-- Tabs can be added dynamically before _APP.navBarMAIN.init -->
        <nav id="mainNavMenu" class="navMenu1">
            <ul id="mainNavMenu_ul">
                <!-- <li id="navTab_MENUBUTTON" onclick="this.classList.toggle('change');"> -->
                <li id="navTab_MENUBUTTON">
                    <div class="bar1"></div>
                    <div class="bar2"></div>
                    <div class="bar3"></div>
                </li>

                <li id="navTab_gameName">GAME</li>
                <!-- <li id="navTab_info">Info</li> -->
            </ul>
        </nav>

        <div id="main">

            <!-- Views can be added dynamically before _APP.navBarMAIN.init -->
            <div id="mainNavMenuViews">
                <!-- <div id="navView_info"    class="navView"> -->
                    <!-- navView_info<br> -->
                <!-- </div> -->
            </div>

            <!-- Contains the canvas layers for the game. -->
            <div id="gameView" tabindex="0">
                <!-- <canvas class="canvasLayer" width="224" height="224"></canvas> -->
            </div>

        </div>
    </div>
</body>

</html>